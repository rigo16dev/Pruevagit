CREATE TABLE rol (
    id_rol INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL
);

CREATE TABLE usuarios (
    id_usuario INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    apellido VARCHAR(50) NOT NULL,
    password VARCHAR(255) NOT NULL,
    id_rol INT,
    FOREIGN KEY (id_rol) REFERENCES rol(id_rol) ON DELETE SET NULL
);

-- Tabla de Categorías
CREATE TABLE categorias (
    id_categoria INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL
);

-- Tabla de Libros
CREATE TABLE libros (
    id_libro INT PRIMARY KEY AUTO_INCREMENT,
    titulo VARCHAR(100) NOT NULL,
    autor VARCHAR(100) NOT NULL,
    anio_publicacion INT NOT NULL,
    estado VARCHAR(20) DEFAULT 'Disponible',
    foto VARCHAR(255),  -- Ruta o nombre del archivo de imagen
    id_categoria INT,
    FOREIGN KEY (id_categoria) REFERENCES categorias(id_categoria) ON DELETE SET NULL
);

-- Tabla de Préstamos
CREATE TABLE prestamos (
    id_prestamo INT PRIMARY KEY AUTO_INCREMENT,
    id_externo VARCHAR(50) NOT NULL,  -- Identificador del usuario (no clave foránea directa)
    id_libro INT,
    fecha_prestamo DATE DEFAULT CURRENT_DATE,
    hora_prestamo TIME DEFAULT CURRENT_TIME,
    fecha_devolucion DATE NULL,
    observaciones TEXT NULL,
    FOREIGN KEY (id_libro) REFERENCES libros(id_libro) ON DELETE CASCADE
);

-- Tabla de Historial de Operaciones
CREATE TABLE historial_operaciones (
    id_historial INT PRIMARY KEY AUTO_INCREMENT,
    id_externo VARCHAR(50) NOT NULL,
    operacion VARCHAR(100) NOT NULL,
    fecha DATE DEFAULT CURRENT_DATE,
    hora TIME DEFAULT CURRENT_TIME,
    detalles TEXT NULL,
    id_prestamo INT,
    FOREIGN KEY (id_prestamo) REFERENCES prestamos(id_prestamo) ON DELETE SET NULL
);
